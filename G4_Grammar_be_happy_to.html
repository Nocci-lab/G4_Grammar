<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>be happy to ä¸¦ã¹æ›¿ãˆ</title>

<style>
body{
  font-family:"Hiragino Maru Gothic ProN","Hiragino Maru Gothic",Arial,sans-serif;
  background:#f4f8ff;
  padding:20px;
  font-size:30px;
}

h1{
  text-align:center;
  font-size:42px;
  margin-bottom:10px;
}

.subtitle{
  text-align:center;
  font-size:24px;
  margin-bottom:20px;
}

.question{
  background:white;
  padding:24px;
  margin-bottom:26px;
  border-radius:18px;
  box-shadow:0 4px 8px rgba(0,0,0,0.15);
}

.jp{
  font-weight:bold;
  margin-bottom:14px;
}

.answer-area{
  min-height:60px;
  border:3px dashed #4caf50;
  border-radius:12px;
  padding:10px;
  margin-bottom:14px;
}

.word-bank{
  margin-bottom:10px;
}

.word-bank span{
  display:inline-block;
  background:#fff;
  border:3px solid #2196f3; /* é’ */
  border-radius:10px;
  padding:8px 14px;
  margin:6px;
  cursor:pointer;
}

.answer-area span{
  display:inline-block;
  background:#e8f5e9;
  border:3px solid #4caf50; /* ç·‘ */
  border-radius:10px;
  padding:8px 14px;
  margin:6px;
  cursor:pointer;
}

.result{
  font-size:34px;
  margin-top:10px;
}

.readBtn{
  display:none;
  margin-top:10px;
  font-size:26px;
  padding:10px 18px;
  border-radius:12px;
  border:none;
  background:#2196f3;
  color:white;
  cursor:pointer;
}

button{
  font-size:28px;
  padding:14px 24px;
  border-radius:14px;
  border:none;
  cursor:pointer;
}

#checkBtn{
  display:block;
  margin:20px auto;
  background:#4caf50;
  color:white;
}

#shuffleBtn{
  display:block;
  margin:0 auto 30px;
  background:#ff9800;
  color:white;
}

canvas{
  position:fixed;
  top:0;
  left:0;
  pointer-events:none;
}
</style>
</head>

<body>

<h1>be happy to ï½</h1>
<div class="subtitle">
be happy to ï½ã€Œã€œã—ã¦ã†ã‚Œã—ã„ã€<br>
ï¼ˆæ°—æŒã¡ ï¼‹ to ä¸å®šè©ï¼‰
</div>

<button id="shuffleBtn">ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>

<div id="quiz"></div>

<button id="checkBtn">âœ” ç­”ãˆåˆã‚ã›</button>

<canvas id="confetti"></canvas>

<script>
const baseQuestions = [
 {
  jp:"ã‚ãªãŸã«ä¼šãˆã¦ã†ã‚Œã—ã„ã§ã™ã€‚",
  answer:"I am happy to see you.",
  words:["I","am","happy","to","see","you","."]
 },
 {
  jp:"ãã‚Œã‚’çŸ¥ã£ã¦é©šãã¾ã—ãŸã€‚",
  answer:"I was surprised to know that.",
  words:["I","was","surprised","to","know","that","."]
 },
 {
  jp:"ãã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èã„ã¦æ‚²ã—ã‹ã£ãŸã§ã™ã€‚",
  answer:"I was sad to hear the news.",
  words:["I","was","sad","to","hear","the","news","."]
 }
];

const quiz = document.getElementById("quiz");

function shuffle(arr){
  return [...arr].sort(()=>Math.random()-0.5);
}

function buildQuiz(){
  quiz.innerHTML = "";

  const questions = shuffle(
    baseQuestions.map(q=>({
      ...q,
      words: shuffle([...q.words])
    }))
  );

  questions.forEach((q,i)=>{
    const div=document.createElement("div");
    div.className="question";
    div.dataset.answer=q.answer;

    div.innerHTML=`
      <div class="jp">Q${i+1}. ${q.jp}</div>
      <div class="answer-area"></div>
      <div class="word-bank"></div>
      <div class="result"></div>
      <button class="readBtn">ğŸ”Š ã“ã®æ–‡ã‚’èª­ã‚€</button>
    `;

    quiz.appendChild(div);

    const bank=div.querySelector(".word-bank");
    const ans=div.querySelector(".answer-area");
    const res=div.querySelector(".result");
    const readBtn=div.querySelector(".readBtn");

    q.words.forEach(w=>{
      const s=document.createElement("span");
      s.textContent=w;
      s.onclick=()=>{
        if(s.parentElement===bank){
          ans.appendChild(s);
        }else{
          bank.appendChild(s);
        }
      };
      bank.appendChild(s);
    });

    readBtn.onclick=()=>{
      const u=new SpeechSynthesisUtterance(q.answer);
      u.lang="en-US";
      u.rate=0.8;
      speechSynthesis.speak(u);
    };
  });
}

buildQuiz();

document.getElementById("shuffleBtn").onclick = buildQuiz;

document.getElementById("checkBtn").onclick=()=>{
  let allCorrect=true;

  document.querySelectorAll(".question").forEach(qDiv=>{
    const ans=qDiv.querySelector(".answer-area");
    const res=qDiv.querySelector(".result");
    const readBtn=qDiv.querySelector(".readBtn");

    let text=[...ans.children].map(s=>s.textContent).join(" ");
    // ãƒ”ãƒªã‚ªãƒ‰å‰ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤
    text = text.replace(" .",".");

    if(text===qDiv.dataset.answer){
      res.textContent="â­• æ­£è§£ï¼";
      readBtn.style.display="inline-block";
    }else{
      res.textContent="âŒ ã¾ã¡ãŒã„ã€‚ãªã‚‰ã¹ãªãŠãã†ï¼";
      allCorrect=false;
    }
  });

  if(allCorrect){
    startConfetti();
    setTimeout(stopConfetti,5000);
  }
};

/* ç´™å¹é›ª */
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;
let confetti=[],anim;

function startConfetti(){
  confetti=Array.from({length:180},()=>({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    r:Math.random()*6+4,
    d:Math.random()*5+2
  }));
  anim=requestAnimationFrame(draw);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  confetti.forEach(c=>{
    ctx.beginPath();
    ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
    ctx.fillStyle=`hsl(${Math.random()*360},100%,60%)`;
    ctx.fill();
    c.y+=c.d;
    if(c.y>canvas.height) c.y=0;
  });
  anim=requestAnimationFrame(draw);
}

function stopConfetti(){
  cancelAnimationFrame(anim);
  ctx.clearRect(0,0,canvas.width,canvas.height);
}
</script>

</body>
</html>
