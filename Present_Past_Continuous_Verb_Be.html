<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç¾åœ¨é€²è¡Œå½¢ãƒ»éå»é€²è¡Œå½¢ã® beå‹•è©</title>

<style>
  body {
    font-family: "Hiragino Maru Gothic ProN", "Hiragino Maru Gothic", sans-serif;
    background: #f5f7fa;
    padding: 20px;
    font-size: 16px;
  }

  h1 {
    text-align: center;
  }

  .question {
    background: white;
    padding: 18px;
    margin: 16px auto;
    border-radius: 12px;
    max-width: 760px;
  }

  .jp {
    margin-bottom: 8px;
  }

  .en {
    font-size: 22px;
    margin-bottom: 14px;
  }

  .blank {
    display: inline-block;
    min-width: 80px;
    padding: 2px 6px;
    text-align: center;
    font-weight: bold;
    border-bottom: 2px solid #333;
  }

  .choices button {
    margin: 6px;
    padding: 8px 18px;
    font-size: 16px;
    cursor: pointer;
  }

  .choices-print {
    display: none;
    font-size: 16px;
    margin-top: 10px;
  }

  .print-choice {
    display: inline-block;
    margin-right: 20px;
  }

  .selected {
    outline: 3px solid #333;
  }

  .correct {
    background: #4CAF50;
    color: white;
  }

  .wrong {
    background: #f44336;
    color: white;
  }

  .answer {
    margin-top: 8px;
    font-weight: bold;
  }

  .audio-btn {
    margin-top: 10px;
    display: none;
    font-size: 15px;
  }

  .controls {
    text-align: center;
    margin-top: 24px;
  }

  /* ç´™å¹é›ª */
  .confetti {
    position: fixed;
    top: -10px;
    width: 10px;
    height: 10px;
    animation: fall 2.5s linear forwards;
    z-index: 9999;
  }

  @keyframes fall {
    to {
      transform: translateY(110vh) rotate(360deg);
      opacity: 0;
    }
  }

  @media print {
    .choices,
    .controls,
    .answer,
    .audio-btn {
      display: none !important;
    }

    .choices-print {
      display: block;
    }

    body {
      background: white;
    }
  }
</style>
</head>
<body>

<h1>ç¾åœ¨é€²è¡Œå½¢ãƒ»éå»é€²è¡Œå½¢ã® beå‹•è©</h1>

<div id="quiz"></div>

<div class="controls">
  <button onclick="checkAnswers()">ä¸¸ã¤ã‘</button>
  <button onclick="restartGame()">ã‚‚ã†ä¸€åº¦</button>
  <button onclick="window.print()">PDF</button>
</div>

<script>
const choices = ["am", "is", "are", "was", "were"];

const questions = [
  { jp: "ç§ã¯ãƒ†ãƒ¬ãƒ“ã‚’è¦‹ã¦ã„ã¾ã™ã€‚", en: "I ( ) watching TV.", answer: "am" },
  { jp: "ç§ã¯éŸ³æ¥½ã‚’è´ã„ã¦ã„ã¾ã—ãŸã€‚", en: "I ( ) listening to music.", answer: "was" },
  { jp: "ãƒ¡ã‚¢ãƒªãƒ¼ã¯æ—¥æœ¬èªã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚", en: "Mary ( ) studying Japanese.", answer: "is" },
  { jp: "ãƒˆãƒ ã¯ç®—æ•°ã‚’å‹‰å¼·ã—ã¦ã„ã¾ã—ãŸã€‚", en: "Tom ( ) studying math.", answer: "was" },
  { jp: "ç§ãŸã¡ã¯ãŠæ˜¼ã”é£¯ã‚’é£Ÿã¹ã¦ã„ã¾ã™ã€‚", en: "We ( ) having lunch.", answer: "are" },
  { jp: "å½¼ã‚‰ã¯ãƒ•ãƒ©ãƒ³ã‚¹èªã‚’è©±ã—ã¦ã„ã¾ã—ãŸã€‚", en: "They ( ) speaking French.", answer: "were" }
];

const quiz = document.getElementById("quiz");

function buildQuiz() {
  quiz.innerHTML = "";
  document.querySelectorAll(".confetti").forEach(c => c.remove());

  questions.forEach((q, index) => {
    const div = document.createElement("div");
    div.className = "question";

    div.innerHTML = `
      <div class="jp">${index + 1}) ${q.jp}</div>
      <div class="en">${q.en.replace("( )", "( <span class='blank'></span> )")}</div>

      <div class="choices">
        ${choices.map(c => `<button onclick="select(this, '${c}')">${c}</button>`).join("")}
      </div>

      <div class="choices-print">
        ${choices.map(c => `<span class="print-choice">${c}</span>`).join("")}
      </div>

      <div class="answer" data-answer="${q.answer}"></div>
      <button class="audio-btn" onclick="playSentence(this)">ğŸ”Š éŸ³å£°ã‚’èã</button>
    `;

    quiz.appendChild(div);
  });
}

function select(btn, word) {
  const q = btn.closest(".question");
  q.querySelectorAll(".choices button").forEach(b => b.classList.remove("selected"));
  btn.classList.add("selected");
  q.querySelector(".blank").textContent = word;
}

function checkAnswers() {
  let allCorrect = true;

  document.querySelectorAll(".question").forEach(q => {
    const selected = q.querySelector(".selected");
    const blank = q.querySelector(".blank");
    const answerBox = q.querySelector(".answer");
    const audioBtn = q.querySelector(".audio-btn");
    const correct = answerBox.dataset.answer;

    audioBtn.style.display = "inline-block";

    if (!selected || blank.textContent !== correct) {
      allCorrect = false;
      blank.textContent = correct;
      if (selected) selected.classList.add("wrong");
      answerBox.textContent = `Ã— æ­£è§£ï¼š${correct}`;
      return;
    }

    selected.classList.add("correct");
    answerBox.textContent = "â—‹ æ­£è§£";
  });

  if (allCorrect) {
    launchConfetti();
  }
}

function restartGame() {
  buildQuiz();
}

function launchConfetti() {
  for (let i = 0; i < 60; i++) {
    const confetti = document.createElement("div");
    confetti.className = "confetti";
    confetti.style.left = Math.random() * 100 + "vw";
    confetti.style.backgroundColor =
      ["#ff5252", "#ffeb3b", "#4caf50", "#2196f3"][Math.floor(Math.random() * 4)];
    confetti.style.animationDuration = (Math.random() * 1.5 + 2) + "s";
    document.body.appendChild(confetti);
    setTimeout(() => confetti.remove(), 3000);
  }
}

function playSentence(btn) {
  const q = btn.closest(".question");
  const text = q.querySelector(".en").innerText;

  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";

  const voices = speechSynthesis.getVoices();
  const voice = voices.find(v => v.lang === "en-US");
  if (voice) utter.voice = voice;

  speechSynthesis.speak(utter);
}

buildQuiz();
</script>

</body>
</html>
