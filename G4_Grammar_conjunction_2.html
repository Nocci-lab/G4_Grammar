<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ï¼—ã¤ã®ï¼”ç´šæ¥ç¶šè©</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
font-family:"Hiragino Maru Gothic ProN","Hiragino Maru Gothic",sans-serif;
background:#f4f8ff;
text-align:center;
padding:20px;
}

h1{font-size:38px;}

.question{font-size:28px;margin:20px;}
.translation{font-size:22px;color:#555;margin-bottom:15px;}

.choice{
font-size:30px;
margin:10px;
padding:12px 22px;
border-radius:14px;
border:2px solid #1976d2;
background:white;
color:#1976d2;
font-weight:bold;
cursor:pointer;
}

.choice:hover{
background:#1976d2;
color:white;
}

button{
font-size:24px;
padding:10px 18px;
margin:8px;
border-radius:12px;
border:none;
background:#ff9800;
color:white;
cursor:pointer;
}

/* ã‚¹ã‚¿ãƒ³ãƒ— */
#stamp{
position:fixed;
top:40%;
left:50%;
transform:translate(-50%,-50%) scale(0);
font-size:60px;
font-weight:bold;
color:#ff4081;
transition:0.4s;
pointer-events:none;
}

canvas{
position:fixed;
top:0;
left:0;
pointer-events:none;
}
</style>
</head>

<body>

<h1>ï¼—ã¤ã®ï¼”ç´šæ¥ç¶šè©</h1>
<p>å…¨éƒ¨ã§ï¼—å•ã‚ã‚‹ã‚ˆï¼</p>

<div class="question" id="question"></div>
<div class="translation" id="translation"></div>
<div id="choices"></div>

<button onclick="checkAnswer()">ãƒã‚§ãƒƒã‚¯</button>
<button onclick="nextQuestion()">NEXT</button>
<button onclick="reviewMode()">å¾©ç¿’</button>
<button onclick="shuffleQuestions()">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
<button onclick="makePDF()">PDF</button>

<div id="stamp">âœ¨Correct!âœ¨</div>
<canvas id="confetti"></canvas>

<script>

let data=[
{
q:"I was happy (        ) I got a present.",
a:"when",
jp:"ç§ã¯ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’ã‚‚ã‚‰ã£ãŸã¨ãã€ã†ã‚Œã—ã‹ã£ãŸã€‚"
},
{
q:"Please wash your hands (        ) you eat lunch.",
a:"before",
jp:"æ˜¼ã”ã¯ã‚“ã‚’é£Ÿã¹ã‚‹å‰ã«ã€æ‰‹ã‚’æ´—ã£ã¦ãã ã•ã„ã€‚"
},
{
q:"I am going to watch TV (        ) I finish my homework.",
a:"after",
jp:"å®¿é¡Œã‚’çµ‚ãˆãŸã‚ã¨ã§ã€ãƒ†ãƒ¬ãƒ“ã‚’è¦‹ã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚"
},
{
q:"It was raining, (        ) we stayed home.",
a:"so",
jp:"é›¨ãŒé™ã£ã¦ã„ãŸã®ã§ã€å®¶ã«ã„ã¾ã—ãŸã€‚"
},
{
q:"I didn't go to school yesterday (        ) I was sick.",
a:"because",
jp:"ç§ã¯ç—…æ°—ã ã£ãŸã®ã§ã€æ˜¨æ—¥å­¦æ ¡ã«è¡Œãã¾ã›ã‚“ã§ã—ãŸã€‚"
},
{
q:"Take an umbrella (        ) it rains.",
a:"if",
jp:"ã‚‚ã—é›¨ãŒé™ã£ãŸã‚‰ã€ã‹ã•ã‚’æŒã£ã¦ã„ããªã•ã„ã€‚"
},
{
q:"I like math, (        ) I don't like science.",
a:"but",
jp:"ç®—æ•°ã¯å¥½ãã§ã™ãŒã€ç†ç§‘ã¯å¥½ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"
}
];

let current=0;
let selected="";
let wrongList=[];
let answered=false;

function loadQuestion(){
selected="";
answered=false;
document.getElementById("question").innerHTML=data[current].q;
document.getElementById("translation").innerHTML=data[current].jp;

let words=["when","if","because","before","after","but","so"];
words.sort(()=>Math.random()-0.5);

let html="";
words.forEach(w=>{
html+=`<button class="choice" onclick="selectChoice('${w}')">${w}</button>`;
});
document.getElementById("choices").innerHTML=html;
}

function selectChoice(word){
selected=word;
document.getElementById("question").innerHTML=
data[current].q.replace("(        )","("+word+")");
}

function checkAnswer(){
if(selected==="") return;

if(selected===data[current].a){
answered=true;
showStamp();
speak(data[current].q.replace("(        )","("+selected+")"));
}else{
wrongList.push(current);
alert("å¾©ç¿’ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼");
}
}

function nextQuestion(){
if(!answered) return;

current++;
if(current>=data.length){
if(wrongList.length===0){
startConfetti();
setTimeout(stopConfetti,5000);
}else{
alert("å¾©ç¿’ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼");
}
}else{
loadQuestion();
}
}

function reviewMode(){

if(wrongList.length===0){
showFinishStamp();
return;
}

current = wrongList.shift();
loadQuestion();
}

function shuffleQuestions(){
data.sort(()=>Math.random()-0.5);
current=0;
loadQuestion();
}

function speak(text){
const utter=new SpeechSynthesisUtterance(text);
utter.lang="en-US";
utter.rate=0.8;
speechSynthesis.speak(utter);
}

function showFinishStamp(){
const stamp=document.getElementById("stamp");
stamp.innerHTML="ğŸŒ¸ ãŠã¤ã‹ã‚Œã•ã¾ã€‚Good job! ğŸŒ¸";
stamp.style.transform="translate(-50%,-50%) scale(1)";
setTimeout(()=>{
stamp.style.transform="translate(-50%,-50%) scale(0)";
stamp.innerHTML="âœ¨Correct!âœ¨";
},2000);
}


/* ã‚¹ã‚¿ãƒ³ãƒ— */
function showStamp(){
const stamp=document.getElementById("stamp");
stamp.style.transform="translate(-50%,-50%) scale(1)";
setTimeout(()=>{
stamp.style.transform="translate(-50%,-50%) scale(0)";
},1500);
}

/* ç´™å¹é›ª */
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;
let confettiArray=[];
let animation;

function startConfetti(){
confettiArray=Array.from({length:200},()=>({
x:Math.random()*canvas.width,
y:Math.random()*canvas.height,
r:Math.random()*6+4,
d:Math.random()*5+2
}));
animation=requestAnimationFrame(draw);
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
confettiArray.forEach(c=>{
ctx.beginPath();
ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
ctx.fillStyle=`hsl(${Math.random()*360},100%,60%)`;
ctx.fill();
c.y+=c.d;
if(c.y>canvas.height) c.y=0;
});
animation=requestAnimationFrame(draw);
}

function stopConfetti(){
cancelAnimationFrame(animation);
ctx.clearRect(0,0,canvas.width,canvas.height);
}

/* PDF */
async function makePDF(){

const { jsPDF } = window.jspdf;

let htmlContent = `
<div style="
width:760px;
padding:50px;
font-family:'Hiragino Maru Gothic ProN','Hiragino Maru Gothic',sans-serif;
">

<h2 style="text-align:left; font-size:34px; margin-bottom:20px;">
ï¼—ã¤ã®ï¼”ç´šæ¥ç¶šè©
</h2>

<p style="font-size:22px; margin-bottom:30px;">
Name: ____________________ã€€ã€€ã€€Date: ____________________
</p>

<ol style="
font-size:24px;
line-height:2.3;
padding-left:20px;
text-align:left;
">
`;

data.forEach(d=>{
htmlContent += `
<li>
${d.q.replace("(        )","(ã€€ã€€ã€€ã€€ã€€ã€€)")}<br>
<span style="font-size:20px;">${d.jp}</span>
</li>
<br>
`;
});

htmlContent += `
</ol>

<div style="
border:3px solid black;
padding:15px;
font-size:22px;
margin-top:30px;
text-align:left;
">
afterã€€becauseã€€beforeã€€butã€€ifã€€soã€€when
</div>

</div>
`;

let tempDiv=document.createElement("div");
tempDiv.innerHTML=htmlContent;
document.body.appendChild(tempDiv);

const canvas2=await html2canvas(tempDiv,{scale:2});
const imgData=canvas2.toDataURL("image/png");

const pdf=new jsPDF("p","mm","a4");
const width=210;
const height=canvas2.height*width/canvas2.width;

pdf.addImage(imgData,"PNG",0,0,width,height);

pdf.addPage();
pdf.setFontSize(22);
pdf.text("Answer Key",20,25);

data.forEach((d,i)=>{
pdf.text((i+1)+". "+d.a,20,45+i*14);
});

pdf.save("ï¼”ç´šæ¥ç¶šè©ãƒ—ãƒªãƒ³ãƒˆ.pdf");

document.body.removeChild(tempDiv);
}

loadQuestion();

</script>

</body>
</html>
